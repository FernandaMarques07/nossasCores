<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <title>Carrinho</title>
    <link rel="stylesheet" href="./assets/styles/principal.css">
    <link rel="stylesheet" href="./assets/styles/compras.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">
</head>

<body>
    <div class="container">
        <h1>CARRINHO</h1>

        <div class="steps">
            <div class="step active">
                <div class="step-circle">1</div>
                Carrinho
            </div>
            <div class="step">
                <div class="step-circle">2</div>
                Identificação
            </div>
            <div class="step">
                <div class="step-circle">3</div>
                Pagamento
            </div>
            <div class="step">
                <div class="step-circle">4</div>
                Concluído
            </div>
        </div>

        <table id="tabela-carrinho">
            <tr>
                <th class="arrow-cell">
                    Produto
                    <div class="arrow-head"></div>
                </th>
                <th>Quantidade</th>
                <th>Valor</th>
            </tr>
            <!-- Itens do carrinho serão inseridos aqui pelo JavaScript -->
        </table>

        <div class="total">
            <span>Total:</span>
            <span id="total-carrinho">R$ 0,00</span>
        </div>

        <div class="continuar" onclick="continuarComprando()">Continuar comprando</div>
        <button class="btn-finalizar" onclick="finalizarCompra()">Finalizar Compra</button>
    </div>

    <script>
        function carregarCarrinho() {
            const carrinho = JSON.parse(localStorage.getItem('carrinho')) || [];
            const tabela = document.getElementById('tabela-carrinho');
            const corpoTabela = document.createElement('tbody');
            
            // Limpa a tabela (exceto o cabeçalho)
            while (tabela.rows.length > 1) {
                tabela.deleteRow(1);
            }
            
            let total = 0;
            
            carrinho.forEach((item, index) => {
                const linha = corpoTabela.insertRow();
                
                // Célula do produto
                const celulaProduto = linha.insertCell(0);
                celulaProduto.innerHTML = `
                    <div class="produto-img">
                        <img src="${item.imagem}" alt="${item.nome}">
                        <span>${item.nome}</span>
                    </div>
                `;
                
                // Célula da quantidade
                const celulaQuantidade = linha.insertCell(1);
                celulaQuantidade.innerHTML = `
                    <div class="quantidade">
                        <button onclick="alterarQuantidade(${index}, -1)">-</button>
                        <span>${item.quantidade}</span>
                        <button onclick="alterarQuantidade(${index}, 1)">+</button>
                    </div>
                `;
                
                // Célula do valor
                const valorTotal = item.preco * item.quantidade;
                total += valorTotal;
                
                const celulaValor = linha.insertCell(2);
                celulaValor.className = 'valor';
                celulaValor.innerHTML = `R$ ${valorTotal.toFixed(2).replace('.', ',')}`;
            });
            
            tabela.appendChild(corpoTabela);
            document.getElementById('total-carrinho').textContent = `R$ ${total.toFixed(2).replace('.', ',')}`;
        }
        
        function alterarQuantidade(index, delta) {
            const carrinho = JSON.parse(localStorage.getItem('carrinho')) || [];
            
            carrinho[index].quantidade += delta;
            
            if (carrinho[index].quantidade <= 0) {
                carrinho.splice(index, 1);
            }
            
            localStorage.setItem('carrinho', JSON.stringify(carrinho));
            carregarCarrinho();
        }
        
        function continuarComprando() {
            window.location.href = 'brilhantes.html';
        }
        
        function finalizarCompra() {
            const carrinho = JSON.parse(localStorage.getItem('carrinho')) || [];
            
            if (carrinho.length === 0) {
                alert('Seu carrinho está vazio!');
                return;
            }
            
            alert('Compra finalizada com sucesso! Redirecionando para a página de identificação...');
            window.location.href = 'identificacao.html';
        }
        
        // Carrega o carrinho quando a página é aberta
        window.onload = carregarCarrinho;
    </script>
</body>

</html>
